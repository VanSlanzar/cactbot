(()=>{"use strict";let e=!1,t=null,n=null,o=[],i=0;const l={},d={},a=(e,t)=>{n?o?o.push(e):n.send(JSON.stringify(e)):o?o.push([e,t]):window.OverlayPluginApi.callHandler(JSON.stringify(e),t)},r=e=>{g();const t=d[e.type];null==t||t.forEach((t=>t(e)))},s=r,c=(e,t)=>{var n;g(),d[e]||(d[e]=[],o||a({call:"subscribe",events:[e]})),null===(n=d[e])||void 0===n||n.push(t)},m=(e,t)=>{if(g(),d[e]){const n=d[e],o=null==n?void 0:n.indexOf(t);o&&o>-1&&(null==n||n.splice(o,1))}};const u=e=>(g(),(e=>{g();const t={...e,rseq:0};let o;return n?(t.rseq=i++,o=new Promise((e=>{l[t.rseq]=e})),a(t)):o=new Promise((e=>{a(t,(t=>{e(null===t?null:JSON.parse(t))}))})),o})(e)),g=()=>{if(!e){if("undefined"!=typeof window){if(t=/[\?&]OVERLAY_WS=([^&]+)/.exec(window.location.href),t){const e=function(){n=new WebSocket(null==t?void 0:t[1]),n.addEventListener("error",(e=>{console.error(e)})),n.addEventListener("open",(()=>{console.log("Connected!");const e=null!=o?o:[];o=null,a({call:"subscribe",events:Object.keys(d)});for(const t of e)Array.isArray(t)||a(t)})),n.addEventListener("message",(e=>{var t;try{const n=JSON.parse(e.data);void 0!==n.rseq&&l[n.rseq]?(null===(t=l[n.rseq])||void 0===t||t.call(l,n),delete l[n.rseq]):r(n)}catch(t){return void console.error("Invalid message received: ",e)}})),n.addEventListener("close",(()=>{o=null,console.log("Trying to reconnect..."),setTimeout((()=>{e()}),300)}))};e()}else{const e=function(){if(!window.OverlayPluginApi||!window.OverlayPluginApi.ready)return void setTimeout(e,300);const t=null!=o?o:[];o=null,window.__OverlayCallback=r,a({call:"subscribe",events:Object.keys(d)});for(const e of t)Array.isArray(e)&&a(e[0],e[1])};e()}window.addOverlayListener=c,window.removeOverlayListener=m,window.callOverlayHandler=u,window.dispatchOverlayEvent=s}e=!0}};c("ChangeZone",(e=>{document.getElementById("currentZone").innerText=`currentZone: ${e.zoneName} (${e.zoneID})`})),c("onInCombatChangedEvent",(e=>{document.getElementById("inCombat").innerText="inCombat: act: "+(e.detail.inACTCombat?"yes":"no")+" game: "+(e.detail.inGameCombat?"yes":"no")})),c("onPlayerChangedEvent",(e=>{document.getElementById("hp").innerText=e.detail.currentHP+"/"+e.detail.maxHP+" ("+e.detail.currentShield+")",document.getElementById("mp").innerText=e.detail.currentMP+"/"+e.detail.maxMP,document.getElementById("cp").innerText=e.detail.currentCP+"/"+e.detail.maxCP,document.getElementById("gp").innerText=e.detail.currentGP+"/"+e.detail.maxGP,document.getElementById("job").innerText=e.detail.level+" "+e.detail.job,document.getElementById("debug").innerText=e.detail.debugJob;const t=e.detail.jobDetail;"RDM"===e.detail.job?document.getElementById("jobinfo").innerText=t.whiteMana+" | "+t.blackMana:"WAR"===e.detail.job?document.getElementById("jobinfo").innerText=t.beast:"DRK"===e.detail.job?document.getElementById("jobinfo").innerText=t.blood+" | "+t.darksideMilliseconds+" | "+t.darkArts+" | "+t.livingShadowMilliseconds:"GNB"===e.detail.job?document.getElementById("jobinfo").innerText=t.cartridges+t.continuationState:"PLD"===e.detail.job?document.getElementById("jobinfo").innerText=t.oath:"BRD"===e.detail.job?document.getElementById("jobinfo").innerText=t.songName+" | "+t.songProcs+" | "+t.soulGauge+" | "+t.songMilliseconds:"DNC"===e.detail.job?document.getElementById("jobinfo").innerText=t.feathers+" | "+t.esprit+" | ("+t.steps+") | "+t.currentStep:"NIN"===e.detail.job?document.getElementById("jobinfo").innerText=t.hutonMilliseconds+" | "+t.ninkiAmount:"DRG"===e.detail.job?document.getElementById("jobinfo").innerText=t.bloodMilliseconds+" | "+t.lifeMilliseconds+" | "+t.eyesAmount:"BLM"===e.detail.job?document.getElementById("jobinfo").innerText=t.umbralStacks+" ("+t.umbralMilliseconds+") | "+t.umbralHearts+" | "+t.foulCount+" "+t.enochian+" ("+t.nextPolyglotMilliseconds+")":"THM"===e.detail.job?document.getElementById("jobinfo").innerText=t.umbralStacks+" ("+t.umbralMilliseconds+")":"WHM"===e.detail.job?document.getElementById("jobinfo").innerText=t.lilyStacks+" ("+t.lilyMilliseconds+") | "+t.bloodlilyStacks:"SMN"===e.detail.job?document.getElementById("jobinfo").innerText=t.aetherflowStacks+" | "+t.dreadwyrmStacks+" | "+t.bahamutStance+" | "+t.bahamutSummoned+" ( "+t.stanceMilliseconds+") | "+t.phoenixReady:"SCH"===e.detail.job?document.getElementById("jobinfo").innerText=t.aetherflowStacks+" | "+t.fairyGauge+" | "+t.fairyStatus+" ("+t.fairyMilliseconds+")":"ACN"===e.detail.job?document.getElementById("jobinfo").innerText=t.aetherflowStacks:"AST"===e.detail.job?document.getElementById("jobinfo").innerText=t.heldCard+" ("+t.arcanums+")":"MNK"===e.detail.job?document.getElementById("jobinfo").innerText=t.lightningStacks+" ("+t.lightningMilliseconds+") | "+t.chakraStacks+" | "+t.lightningTimerFrozen:"PGL"===e.detail.job?document.getElementById("jobinfo").innerText=t.lightningStacks+" ("+t.lightningMilliseconds+")":"MCH"===e.detail.job?document.getElementById("jobinfo").innerText=t.heat+" ("+t.overheatMilliseconds+") | "+t.battery+" ("+t.batteryMilliseconds+") | last: "+t.lastBatteryAmount+" | "+t.overheatActive+" | "+t.robotActive:"SAM"===e.detail.job?document.getElementById("jobinfo").innerText=t.kenki+" | "+t.meditationStacks+"("+t.setsu+","+t.getsu+","+t.ka+")":document.getElementById("jobinfo").innerText="",document.getElementById("pos").innerText=e.detail.pos.x.toFixed(2)+","+e.detail.pos.y.toFixed(2)+","+e.detail.pos.z.toFixed(2),document.getElementById("rotation").innerText=e.detail.rotation,document.getElementById("bait").innerText=e.detail.bait})),c("EnmityTargetData",(e=>{const t=e.Target;t?(document.getElementById("target").innerText=t.Name,document.getElementById("tid").innerText=t.ID.toString(16),document.getElementById("tdistance").innerText=t.Distance):(document.getElementById("target").innerText="--",document.getElementById("tid").innerText="",document.getElementById("tdistance").innerText="")})),c("onGameExistsEvent",(e=>{})),c("onGameActiveChangedEvent",(e=>{})),c("onLogEvent",(e=>{for(let t=0;t<e.detail.logs.length;t++){const n=e.detail.logs[t].match("00:0038:tts:(.*)");n&&u({call:"cactbotSay",text:n[1]})}})),c("onUserFileChanged",(e=>{console.log(`User file ${e.file} changed!`)})),c("FileChanged",(e=>{console.log(`File ${e.file} changed!`)})),u({call:"cactbotRequestState"})})();