(()=>{"use strict";const e=["timestamp","source","id","ability","target","capture"],t=["timestamp","source","sourceId","id","ability","targetId","target","capture"],a=["timestamp","sourceId","source","id","ability","targetId","target","flags","flag0","flag1","flag2","flag3","flag4","flag5","flag6","flag7","flag8","flag9","flag10","flag11","flag12","flag13","flag14","targetHp","targetMaxHp","targetMp","targetMaxMp","targetX","targetY","targetZ","targetHeading","hp","maxHp","mp","maxMp","x","y","z","heading","capture"],s=["timestamp","targetId","target","id","capture"],i=["timestamp","name","capture"],r=["timestamp","id","name","job","level","hp","x","y","z","npcId","capture"],n=["timestamp","id","name","hp","x","y","z","capture"],o=["timestamp","targetId","target","effect","source","duration","capture"],l=["timestamp","targetId","target","job","hp","maxHp","mp","maxMp","x","y","z","heading","data0","data1","data2","data3","data4","capture"],p=["timestamp","targetId","target","effect","source","capture"],m=["timestamp","job","strength","dexterity","vitality","intelligence","mind","piety","attackPower","directHit","criticalHit","attackMagicPotency","healMagicPotency","determination","skillSpeed","spellSpeed","tenacity","capture"],d=["timestamp","source","sourceId","target","targetId","id","capture"],c=["timestamp","target","source","capture"],h=["timestamp","name","hp","capture"],u=["timestamp","code","line","capture"],g=["timestamp","code","line","name","capture"],f=["timestamp","code","line","capture"],y=["timestamp","code","line","capture"],b=["timestamp","code","name","line","capture"],C=["timestamp","name","capture"],v=["timestamp","instance","command","data0","data1","data2","data3","capture"];class x{static startsUsing(t){void 0===t&&(t={}),x.validateParams(t,"startsUsing",e);const a=x.trueIfUndefined(t.capture);let s=x.maybeCapture(a,"timestamp","\\y{Timestamp}")+" 14:"+x.maybeCapture(a,"id",t.id,"\\y{AbilityCode}")+":";return(t.source||t.id||t.target||a)&&(s+=x.maybeCapture(a,"source",t.source,".*?")+" starts using "),(t.ability||t.target||a)&&(s+=x.maybeCapture(a,"ability",t.ability,".*?")+" on "),(t.target||a)&&(s+=x.maybeCapture(a,"target",t.target,".*?")+"\\."),x.parse(s)}static ability(e){void 0===e&&(e={}),x.validateParams(e,"ability",t);const a=x.trueIfUndefined(e.capture);let s=x.maybeCapture(a,"timestamp","\\y{Timestamp}")+" 1[56]:"+x.maybeCapture(a,"sourceId","\\y{ObjectId}")+":"+x.maybeCapture(a,"source",e.source,"[^:]*?")+":";return(e.id||e.ability||e.target||e.targetId||a)&&(s+=x.maybeCapture(a,"id",e.id,"\\y{AbilityCode}")+":"),(e.ability||e.target||e.targetId||a)&&(s+=x.maybeCapture(a,"ability",e.ability,"[^:]*?")+":"),(e.target||e.targetId||a)&&(s+=x.maybeCapture(a,"targetId","\\y{ObjectId}")+":"),(e.target||a)&&(s+=x.maybeCapture(a,"target",e.target,"[^:]*?")+":"),x.parse(s)}static abilityFull(e){void 0===e&&(e={}),x.validateParams(e,"abilityFull",a);const t=x.trueIfUndefined(e.capture),s=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 1[56]:"+x.maybeCapture(t,"sourceId",e.sourceId,"\\y{ObjectId}")+":"+x.maybeCapture(t,"source",e.source,"[^:]*?")+":"+x.maybeCapture(t,"id",e.id,"\\y{AbilityCode}")+":"+x.maybeCapture(t,"ability",e.ability,"[^:]*?")+":"+x.maybeCapture(t,"targetId",e.targetId,"\\y{ObjectId}")+":"+x.maybeCapture(t,"target",e.target,"[^:]*?")+":"+x.maybeCapture(t,"flags",e.flags,"[^:]*?")+":"+x.maybeCapture(t,"flag0",e.flag0,"[^:]*?")+":"+x.maybeCapture(t,"flag1",e.flag1,"[^:]*?")+":"+x.maybeCapture(t,"flag2",e.flag2,"[^:]*?")+":"+x.maybeCapture(t,"flag3",e.flag3,"[^:]*?")+":"+x.maybeCapture(t,"flag4",e.flag4,"[^:]*?")+":"+x.maybeCapture(t,"flag5",e.flag5,"[^:]*?")+":"+x.maybeCapture(t,"flag6",e.flag6,"[^:]*?")+":"+x.maybeCapture(t,"flag7",e.flag7,"[^:]*?")+":"+x.maybeCapture(t,"flag8",e.flag8,"[^:]*?")+":"+x.maybeCapture(t,"flag9",e.flag9,"[^:]*?")+":"+x.maybeCapture(t,"flag10",e.flag10,"[^:]*?")+":"+x.maybeCapture(t,"flag11",e.flag11,"[^:]*?")+":"+x.maybeCapture(t,"flag12",e.flag12,"[^:]*?")+":"+x.maybeCapture(t,"flag13",e.flag13,"[^:]*?")+":"+x.maybeCapture(t,"flag14",e.flag13,"[^:]*?")+":"+x.optional(x.maybeCapture(t,"targetHp",e.targetHp,"\\y{Float}"))+":"+x.optional(x.maybeCapture(t,"targetMaxHp",e.targetMaxHp,"\\y{Float}"))+":"+x.optional(x.maybeCapture(t,"targetMp",e.targetMp,"\\y{Float}"))+":"+x.optional(x.maybeCapture(t,"targetMaxMp",e.targetMaxMp,"\\y{Float}"))+":"+x.optional("\\y{Float}")+":"+x.optional("\\y{Float}")+":"+x.optional(x.maybeCapture(t,"targetX",e.targetX,"\\y{Float}"))+":"+x.optional(x.maybeCapture(t,"targetY",e.targetY,"\\y{Float}"))+":"+x.optional(x.maybeCapture(t,"targetZ",e.targetZ,"\\y{Float}"))+":"+x.optional(x.maybeCapture(t,"targetHeading",e.targetHeading,"\\y{Float}"))+":"+x.maybeCapture(t,"hp",e.hp,"\\y{Float}")+":"+x.maybeCapture(t,"maxHp",e.maxHp,"\\y{Float}")+":"+x.maybeCapture(t,"mp",e.mp,"\\y{Float}")+":"+x.maybeCapture(t,"maxMp",e.maxMp,"\\y{Float}")+":\\y{Float}:\\y{Float}:"+x.maybeCapture(t,"x",e.x,"\\y{Float}")+":"+x.maybeCapture(t,"y",e.y,"\\y{Float}")+":"+x.maybeCapture(t,"z",e.z,"\\y{Float}")+":"+x.maybeCapture(t,"heading",e.heading,"\\y{Float}")+":.*?$";return x.parse(s)}static headMarker(e){void 0===e&&(e={}),x.validateParams(e,"headMarker",s);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 1B:"+x.maybeCapture(t,"targetId",e.targetId,"\\y{ObjectId}")+":"+x.maybeCapture(t,"target",e.target,"[^:]*?")+":....:....:"+x.maybeCapture(t,"id",e.id,"....")+":";return x.parse(a)}static addedCombatant(e){void 0===e&&(e={}),x.validateParams(e,"addedCombatant",i);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 03:\\y{ObjectId}:Added new combatant "+x.maybeCapture(t,"name",e.name,".*?")+"\\.";return x.parse(a)}static addedCombatantFull(e){void 0===e&&(e={}),x.validateParams(e,"addedCombatantFull",r);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 03:"+x.maybeCapture(t,"id",e.id,"\\y{ObjectId}")+":Added new combatant "+x.maybeCapture(t,"name",e.name,"[^:]*?")+"\\. {2}Job: "+x.maybeCapture(t,"job",e.job,"[^:]*?")+" Level: "+x.maybeCapture(t,"level",e.level,"[^:]*?")+" Max HP: "+x.maybeCapture(t,"hp",e.hp,"[0-9]+")+"..*?Pos: \\("+x.maybeCapture(t,"x",e.x,"\\y{Float}")+","+x.maybeCapture(t,"y",e.y,"\\y{Float}")+","+x.maybeCapture(t,"z",e.z,"\\y{Float}")+"\\)(?: \\("+x.maybeCapture(t,"npcId",e.npcId,".*?")+"\\))?\\.";return x.parse(a)}static removingCombatant(e){void 0===e&&(e={}),x.validateParams(e,"removingCombatant",n);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 04:"+x.maybeCapture(t,"id","\\y{ObjectId}")+":Removing combatant "+x.maybeCapture(t,"name",e.name,".*?")+"\\..*?Max HP: "+x.maybeCapture(t,"hp",e.hp,"[0-9]+")+"."+x.optional(".*?Pos: \\("+x.maybeCapture(t,"x",e.x,"\\y{Float}")+","+x.maybeCapture(t,"y",e.y,"\\y{Float}")+","+x.maybeCapture(t,"z",e.z,"\\y{Float}")+"\\)");return x.parse(a)}static gainsEffect(e){void 0===e&&(e={}),x.validateParams(e,"gainsEffect",o);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 1A:"+x.maybeCapture(t,"targetId",e.targetId,"\\y{ObjectId}")+":"+x.maybeCapture(t,"target",e.target,".*?")+" gains the effect of "+x.maybeCapture(t,"effect",e.effect,".*?")+" from "+x.maybeCapture(t,"source",e.source,".*?")+" for "+x.maybeCapture(t,"duration",e.duration,"\\y{Float}")+" Seconds\\.";return x.parse(a)}static statusEffectExplicit(e){void 0===e&&(e={}),x.validateParams(e,"statusEffectExplicit",l);const t=x.trueIfUndefined(e.capture),a=".*?:",s=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 26:"+x.maybeCapture(t,"targetId",e.targetId,"\\y{ObjectId}")+":"+x.maybeCapture(t,"target",e.target,"[^:]*?")+":[0-9A-F]{0,6}"+x.maybeCapture(t,"job",e.job,"[0-9A-F]{0,2}")+":"+x.maybeCapture(t,"hp",e.hp,"\\y{Float}")+":"+x.maybeCapture(t,"maxHp",e.maxHp,"\\y{Float}")+":"+x.maybeCapture(t,"mp",e.mp,"\\y{Float}")+":"+x.maybeCapture(t,"maxMp",e.maxMp,"\\y{Float}")+":"+a+a+x.optional(x.maybeCapture(t,"x",e.x,"\\y{Float}"))+":"+x.optional(x.maybeCapture(t,"y",e.y,"\\y{Float}"))+":"+x.optional(x.maybeCapture(t,"z",e.z,"\\y{Float}"))+":"+x.optional(x.maybeCapture(t,"heading",e.heading,"\\y{Float}"))+":"+x.maybeCapture(t,"data0",e.data0,"[^:]*?")+":"+x.maybeCapture(t,"data1",e.data1,"[^:]*?")+":"+x.optional(x.maybeCapture(t,"data2",e.data2,"[^:]*?")+":")+x.optional(x.maybeCapture(t,"data3",e.data3,"[^:]*?")+":")+x.optional(x.maybeCapture(t,"data4",e.data4,"[^:]*?")+":");return x.parse(s)}static losesEffect(e){void 0===e&&(e={}),x.validateParams(e,"losesEffect",p);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 1E:"+x.maybeCapture(t,"targetId",e.targetId,"\\y{ObjectId}")+":"+x.maybeCapture(t,"target",e.target,".*?")+" loses the effect of "+x.maybeCapture(t,"effect",e.effect,".*?")+" from "+x.maybeCapture(t,"source",e.source,".*?")+"\\.";return x.parse(a)}static tether(e){void 0===e&&(e={}),x.validateParams(e,"tether",d);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 23:"+x.maybeCapture(t,"sourceId",e.sourceId,"\\y{ObjectId}")+":"+x.maybeCapture(t,"source",e.source,"[^:]*?")+":"+x.maybeCapture(t,"targetId",e.targetId,"\\y{ObjectId}")+":"+x.maybeCapture(t,"target",e.target,"[^:]*?")+":....:....:"+x.maybeCapture(t,"id",e.id,"....")+":";return x.parse(a)}static wasDefeated(e){void 0===e&&(e={}),x.validateParams(e,"wasDefeated",c);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 19:"+x.maybeCapture(t,"target",e.target,".*?")+" was defeated by "+x.maybeCapture(t,"source",e.source,".*?")+"\\.";return x.parse(a)}static hasHP(e){void 0===e&&(e={}),x.validateParams(e,"hasHP",h);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 0D:"+x.maybeCapture(t,"name",e.name,".*?")+" HP at "+x.maybeCapture(t,"hp",e.hp,"\\d+")+"%";return x.parse(a)}static echo(e){return void 0===e&&(e={}),x.validateParams(e,"echo",u),x.gameLog({line:e.line,capture:e.capture,code:"0038"})}static dialog(e){void 0===e&&(e={}),x.validateParams(e,"dialog",g);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 00:"+x.maybeCapture(t,"code","0044")+":"+x.maybeCapture(t,"name",e.name,".*?")+":"+x.maybeCapture(t,"line",e.line,".*")+"$";return x.parse(a)}static message(e){return void 0===e&&(e={}),x.validateParams(e,"message",f),x.gameLog({line:e.line,capture:e.capture,code:"0839"})}static gameLog(e){void 0===e&&(e={}),x.validateParams(e,"gameLog",y);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 00:"+x.maybeCapture(t,"code",e.code,"....")+":"+x.maybeCapture(t,"line",e.line,".*")+"$";return x.parse(a)}static gameNameLog(e){void 0===e&&(e={}),x.validateParams(e,"gameNameLog",b);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 00:"+x.maybeCapture(t,"code",e.code,"....")+":"+x.maybeCapture(t,"name",e.name,"[^:]*")+":"+x.maybeCapture(t,"line",e.line,".*")+"$";return x.parse(a)}static statChange(e){void 0===e&&(e={}),x.validateParams(e,"statChange",m);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 0C:Player Stats: "+x.maybeCapture(t,"job",e.job,"\\d+")+":"+x.maybeCapture(t,"strength",e.strength,"\\d+")+":"+x.maybeCapture(t,"dexterity",e.dexterity,"\\d+")+":"+x.maybeCapture(t,"vitality",e.vitality,"\\d+")+":"+x.maybeCapture(t,"intelligence",e.intelligence,"\\d+")+":"+x.maybeCapture(t,"mind",e.mind,"\\d+")+":"+x.maybeCapture(t,"piety",e.piety,"\\d+")+":"+x.maybeCapture(t,"attackPower",e.attackPower,"\\d+")+":"+x.maybeCapture(t,"directHit",e.directHit,"\\d+")+":"+x.maybeCapture(t,"criticalHit",e.criticalHit,"\\d+")+":"+x.maybeCapture(t,"attackMagicPotency",e.attackMagicPotency,"\\d+")+":"+x.maybeCapture(t,"healMagicPotency",e.healMagicPotency,"\\d+")+":"+x.maybeCapture(t,"determination",e.determination,"\\d+")+":"+x.maybeCapture(t,"skillSpeed",e.skillSpeed,"\\d+")+":"+x.maybeCapture(t,"spellSpeed",e.spellSpeed,"\\d+")+":0:"+x.maybeCapture(t,"tenacity",e.tenacity,"\\d+");return x.parse(a)}static changeZone(e){void 0===e&&(e={}),x.validateParams(e,"changeZone",C);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 01:Changed Zone to "+x.maybeCapture(t,"name",e.name,".*?")+"\\.";return x.parse(a)}static network6d(e){void 0===e&&(e={}),x.validateParams(e,"network6d",v);const t=x.trueIfUndefined(e.capture),a=x.maybeCapture(t,"timestamp","\\y{Timestamp}")+" 21:"+x.maybeCapture(t,"instance",e.instance,".*?")+":"+x.maybeCapture(t,"command",e.command,".*?")+":"+x.maybeCapture(t,"data0",e.data0,".*?")+":"+x.maybeCapture(t,"data1",e.data1,".*?")+":"+x.maybeCapture(t,"data2",e.data2,".*?")+":"+x.maybeCapture(t,"data3",e.data3,".*?")+"$";return x.parse(a)}static maybeCapture(e,t,a,s){return a||(a=s),a=x.anyOf(a),e?x.namedCapture(t,a):a}static optional(e){return`(?:${e})?`}static namedCapture(e,t){return e.includes(">")&&console.error('"'+e+'" contains ">".'),e.includes("<")&&console.error('"'+e+'" contains ">".'),"(?<"+e+">"+t+")"}static anyOf(...e){let t=[];return t=1===e.length?Array.isArray(e[0])?e[0]:e[0]?[e[0]]:[]:e,(e=>`(?:${e.map((e=>e instanceof RegExp?e.source:e)).join("|")})`)(t)}static parse(e){const t={Timestamp:"^.{14}",NetTimestamp:".{33}",NetField:"(?:[^|]*\\|)",LogType:"[0-9A-Fa-f]{2}",AbilityCode:"[0-9A-Fa-f]{1,8}",ObjectId:"[0-9A-F]{8}",Name:"(?:[^\\s:|]+(?: [^\\s:|]+)?|)",Float:"-?[0-9]+(?:[.,][0-9]+)?(?:E-?[0-9]+)?"};let a="i";return e instanceof RegExp&&(a+=(e.global?"g":"")+(e.multiline?"m":""),e=e.source),e=e.replace(/\\y\{(.*?)\}/g,((e,a)=>t[a]||e)),new RegExp(e,a)}static parseGlobal(e){const t=x.parse(e);let a="gi";return a+=e.multiline?"m":"",new RegExp(t.source,a)}static trueIfUndefined(e){return void 0===e||!!e}static validateParams(e,t,a){if(null===e)return;if("object"!=typeof e)return;const s=Object.keys(e);for(let e=0;e<s.length;++e){const i=s[e];if(i&&!a.includes(i))throw new Error(`${t}: invalid parameter '${i}'.  Valid params: ${JSON.stringify(a)}`)}}}const I=(e,t,a)=>{var s,i,r,n,o,l;e=null!=e?e:{};const p=[];for(const e of Object.values(a))"object"==typeof e&&p.push(e.field);x.validateParams(e,t,["capture",...p]);const m=x.trueIfUndefined(e.capture),d=Object.keys(a);let c;if(m)c=d[d.length-1];else{c=0;for(const t of d){if("object"!=typeof(null!==(s=a[t])&&void 0!==s?s:{}))continue;const r=null===(i=a[t])||void 0===i?void 0:i.field;r&&r in e&&(c=t)}}let h="^",u=-1;for(const s in a){const i=parseInt(s),p=i-u-1;1===p?h+="\\y{NetField}":p>1&&(h+=`\\y{NetField}{${p}}`),u=i;const d=a[i];if("object"!=typeof d)throw new Error(`${t}: invalid value: ${JSON.stringify(d)}`);const g=null===(r=a[i])||void 0===r?void 0:r.field,f=null!==(l=null===(o=null===(n=a[i])||void 0===n?void 0:n.value)||void 0===o?void 0:o.toString())&&void 0!==l?l:"[^|]*";if(h+=g?x.maybeCapture(m,g,e[g],f)+"\\|":f+"\\|",i>=(null!=c?c:0))break}return x.parse(h)};class N{static startsUsing(e){return I(e,"startsUsing",{0:{field:"type",value:"20"},1:{field:"timestamp"},2:{field:"sourceId"},3:{field:"source"},4:{field:"id"},5:{field:"ability"},6:{field:"targetId"},7:{field:"target"},8:{field:"castTime"}})}static ability(e){return I(e,"ability",{0:{field:"type",value:"2[12]"},1:{field:"timestamp"},2:{field:"sourceId"},3:{field:"source"},4:{field:"id"},5:{field:"ability"},6:{field:"targetId"},7:{field:"target"}})}static abilityFull(e){return I(e,"abilityFull",{0:{field:"type",value:"2[12]"},1:{field:"timestamp"},2:{field:"sourceId"},3:{field:"source"},4:{field:"id"},5:{field:"ability"},6:{field:"targetId"},7:{field:"target"},8:{field:"flags"},9:{field:"damage"},24:{field:"targetCurrentHp"},25:{field:"targetMaxHp"},40:{field:"x"},41:{field:"y"},42:{field:"z"},43:{field:"heading"}})}static headMarker(e){return I(e,"headMarker",{0:{field:"type",value:"27"},1:{field:"timestamp"},2:{field:"targetId"},3:{field:"target"},6:{field:"id"}})}static addedCombatant(e){return I(e,"addedCombatant",{0:{field:"type",value:"03"},1:{field:"timestamp"},2:{field:"id"},3:{field:"name"}})}static addedCombatantFull(e){return I(e,"addedCombatantFull",{0:{field:"type",value:"03"},1:{field:"timestamp"},2:{field:"id"},3:{field:"name"},4:{field:"job"},5:{field:"level"},6:{field:"ownerId"},8:{field:"world"},9:{field:"npcNameId"},10:{field:"npcBaseId"},11:{field:"currentHp"},12:{field:"hp"},17:{field:"x"},18:{field:"y"},19:{field:"z"},20:{field:"heading"}})}static removingCombatant(e){return I(e,"removingCombatant",{0:{field:"type",value:"04"},1:{field:"timestamp"},2:{field:"id"},3:{field:"name"},12:{field:"hp"}})}static gainsEffect(e){return I(e,"gainsEffect",{0:{field:"type",value:"26"},1:{field:"timestamp"},2:{field:"effectId"},3:{field:"effect"},4:{field:"duration"},5:{field:"sourceId"},6:{field:"source"},7:{field:"targetId"},8:{field:"target"},9:{field:"count"}})}static statusEffectExplicit(e){return I(e,"statusEffectExplicit",{0:{field:"type",value:"38"},1:{field:"timestamp"},2:{field:"targetId"},3:{field:"target"},5:{field:"hp"},6:{field:"maxHp"},11:{field:"x"},12:{field:"y"},13:{field:"z"},14:{field:"heading"},15:{field:"data0"},16:{field:"data1"},17:{field:"data2"},18:{field:"data3"},19:{field:"data4"}})}static losesEffect(e){return I(e,"losesEffect",{0:{field:"type",value:"30"},1:{field:"timestamp"},2:{field:"effectId"},3:{field:"effect"},5:{field:"sourceId"},6:{field:"source"},7:{field:"targetId"},8:{field:"target"},9:{field:"count"}})}static tether(e){return I(e,"tether",{0:{field:"type",value:"35"},1:{field:"timestamp"},2:{field:"sourceId"},3:{field:"source"},4:{field:"targetId"},5:{field:"target"},8:{field:"id"}})}static wasDefeated(e){return I(e,"wasDefeated",{0:{field:"type",value:"25"},1:{field:"timestamp"},2:{field:"targetId"},3:{field:"target"},4:{field:"sourceId"},5:{field:"source"}})}static echo(e){return void 0===e&&(e={}),x.validateParams(e,"echo",["type","timestamp","code","name","line","capture"]),e.code="0038",N.gameLog(e)}static dialog(e){return void 0===e&&(e={}),x.validateParams(e,"dialog",["type","timestamp","code","name","line","capture"]),e.code="0044",N.gameLog(e)}static message(e){return void 0===e&&(e={}),x.validateParams(e,"message",["type","timestamp","code","name","line","capture"]),e.code="0839",N.gameLog(e)}static gameLog(e){return I(e,"gameLog",{0:{field:"type",value:"00"},1:{field:"timestamp"},2:{field:"code"},3:{field:"name"},4:{field:"line"}})}static gameNameLog(e){return N.gameLog(e)}static statChange(e){return I(e,"statChange",{0:{field:"type",value:"12"},1:{field:"timestamp"},2:{field:"job"},3:{field:"strength"},4:{field:"dexterity"},5:{field:"vitality"},6:{field:"intelligence"},7:{field:"mind"},8:{field:"piety"},9:{field:"attackPower"},10:{field:"directHit"},11:{field:"criticalHit"},12:{field:"attackMagicPotency"},13:{field:"healMagicPotency"},14:{field:"determination"},15:{field:"skillSpeed"},16:{field:"spellSpeed"},18:{field:"tenacity"}})}static changeZone(e){return I(e,"changeZone",{0:{field:"type",value:"01"},1:{field:"timestamp"},2:{field:"id"},3:{field:"name"}})}static network6d(e){return I(e,"network6d",{0:{field:"type",value:"33"},1:{field:"timestamp"},2:{field:"instance"},3:{field:"command"},4:{field:"data0"},5:{field:"data1"},6:{field:"data2"},7:{field:"data3"}})}}const M={countdownStart:{en:"Battle commencing in (?<time>\\y{Float}) seconds! \\((?<player>.*?)\\)",de:"Noch (?<time>\\y{Float}) Sekunden bis Kampfbeginn! \\((?<player>.*?)\\)",fr:"Début du combat dans (?<time>\\y{Float}) secondes[ ]?! \\((?<player>.*?)\\)",ja:"戦闘開始まで(?<time>\\y{Float})秒！ \\((?<player>.*?)\\)",cn:"距离战斗开始还有(?<time>\\y{Float})秒！ （(?<player>.*?)）",ko:"전투 시작 (?<time>\\y{Float})초 전! \\((?<player>.*?)\\)"},countdownEngage:{en:"Engage!",de:"Start!",fr:"À l'attaque[ ]?!",ja:"戦闘開始！",cn:"战斗开始！",ko:"전투 시작!"},countdownCancel:{en:"Countdown canceled by (?<player>\\y{Name})",de:"(?<player>\\y{Name}) hat den Countdown abgebrochen",fr:"Le compte à rebours a été interrompu par (?<player>\\y{Name})[ ]?\\.",ja:"(?<player>\\y{Name})により、戦闘開始カウントがキャンセルされました。",cn:"(?<player>\\y{Name})取消了战斗开始倒计时。",ko:"(?<player>\\y{Name}) 님이 초읽기를 취소했습니다\\."},areaSeal:{en:"(?<area>.*?) will be sealed off in (?<time>\\y{Float}) seconds!",de:"Noch (?<time>\\y{Float}) Sekunden, bis sich (?<area>.*?) schließt",fr:"Fermeture (?<area>.*?) dans (?<time>\\y{Float}) secondes[ ]?\\.",ja:"(?<area>.*?)の封鎖まであと(?<time>\\y{Float})秒",cn:"距(?<area>.*?)被封锁还有(?<time>\\y{Float})秒",ko:"(?<time>\\y{Float})초 후에 (?<area>.*?)(이|가) 봉쇄됩니다\\."},areaUnseal:{en:"(?<area>.*?) is no longer sealed.",de:"(?<area>.*?) öffnet sich erneut.",fr:"Ouverture (?<area>.*?)[ ]?!",ja:"(?<area>.*?)の封鎖が解かれた……",cn:"(?<area>.*?)的封锁解除了",ko:"(?<area>.*?)의 봉쇄가 해제되었습니다\\."},craftingStart:{en:"You begin synthesizing (?<count>(an?|\\d+) )?(?<recipe>.*)\\.",de:"Du hast begonnen, durch Synthese (?<count>(ein(e|es|em|er)?|\\d+) )?(?<recipe>.*) herzustellen\\.",fr:"Vous commencez à fabriquer (?<count>(une?|\\d+) )?(?<recipe>.*)\\.",ja:"(?<player>\\y{Name})は(?<recipe>.*)(×(?<count>\\d+))?の製作を開始した。",cn:"(?<player>\\y{Name})开始制作“(?<recipe>.*)”(×(?<count>\\d+))?。",ko:"(?<recipe>.*)(×(?<count>\\d+)개)? 제작을 시작합니다\\."},trialCraftingStart:{en:"You begin trial synthesis of (?<recipe>.*)\\.",de:"Du hast mit der Testsynthese von (?<recipe>.*) begonnen\\.",fr:"Vous commencez une synthèse d'essai pour une? (?<recipe>.*)\\.",ja:"(?<player>\\y{Name})は(?<recipe>.*)の製作練習を開始した。",cn:"(?<player>\\y{Name})开始练习制作(?<recipe>.*)。",ko:"(?<recipe>.*) 제작 연습을 시작합니다\\."},craftingFinish:{en:"You synthesize (?<count>(an?|\\d+) )?(?<recipe>.*)()?\\.",de:"Du hast erfolgreich (?<count>(ein(e|es|em|er)?|\\d+) )?(?<recipe>.*)()? hergestellt\\.",fr:"Vous fabriquez (?<count>(une?|\\d+) )?(?<recipe>.*)()?\\.",ja:"(?<player>\\y{Name})は(?<recipe>.*)()?(×(?<count>\\d+))?を完成させた！",cn:"(?<player>\\y{Name})制作“(?<recipe>.*)()?”(×(?<count>\\d+))?成功！",ko:"(?<player>\\y{Name}) 님이 (?<recipe>.*)()?(×(?<count>\\d+)개)?(을|를) 완성했습니다!"},trialCraftingFinish:{en:"Your trial synthesis of (?<recipe>.*) proved a success!",de:"Die Testsynthese von (?<recipe>.*) war erfolgreich!",fr:"Votre synthèse d'essai pour fabriquer (?<recipe>.*) a été couronnée de succès!",ja:"(?<player>\\y{Name})は(?<recipe>.*)の製作練習に成功した！",cn:"(?<player>\\y{Name})练习制作(?<recipe>.*)成功了！",ko:"(?<recipe>.*) 제작 연습에 성공했습니다!"},craftingFail:{en:"Your synthesis fails!",de:"Deine Synthese ist fehlgeschlagen!",fr:"La synthèse échoue\\.{3}",ja:"(?<player>\\y{Name})は製作に失敗した……",cn:"(?<player>\\y{Name})制作失败了……",ko:"제작에 실패했습니다……\\."},trialCraftingFail:{en:"Your trial synthesis of (?<recipe>.*) failed\\.{3}",de:"Die Testsynthese von (?<recipe>.*) ist fehlgeschlagen\\.{3}",fr:"Votre synthèse d'essai pour fabriquer (?<recipe>.*) s'est soldée par un échec\\.{3}",ja:"(?<player>\\y{Name})は(?<recipe>.*)の製作練習に失敗した……",cn:"(?<player>\\y{Name})练习制作(?<recipe>.*)失败了……",ko:"(?<recipe>.*) 제작 연습에 실패했습니다……\\."},craftingCancel:{en:"You cancel the synthesis\\.",de:"Du hast die Synthese abgebrochen\\.",fr:"La synthèse est annulée\\.",ja:"(?<player>\\y{Name})は製作を中止した。",cn:"(?<player>\\y{Name})中止了制作作业。",ko:"제작을 중지했습니다\\."},trialCraftingCancel:{en:"You abandoned trial synthesis\\.",de:"Testsynthese abgebrochen\\.",fr:"Vous avez interrompu la synthèse d'essai\\.",ja:"(?<player>\\y{Name})は製作練習を中止した。",cn:"(?<player>\\y{Name})停止了练习。",ko:"제작 연습을 중지했습니다\\."}},S=new class{get localeRegex(){return this.regexes||(this.regexes=this.buildLocaleRegexes(M,(e=>x.gameLog({line:e+".*?"})))),this.regexes}get localeNetRegex(){return this.netRegexes||(this.netRegexes=this.buildLocaleRegexes(M,(e=>N.gameLog({line:e+"[^|]*?"})))),this.netRegexes}buildLocaleRegexes(e,t){return Object.fromEntries(Object.entries(e).map((([e,a])=>[e,this.buildLocaleRegex(a,t)])))}buildLocaleRegex(e,t){const a=t(e.en);return{en:a,de:e.de?t(e.de):a,fr:e.fr?t(e.fr):a,ja:e.ja?t(e.ja):a,cn:e.cn?t(e.cn):a,ko:e.ko?t(e.ko):a}}},P=(S.localeRegex,S.localeNetRegex);class w{static cloneData(e,t=["options","party"]){let a;a=Array.isArray(e)?[]:{};for(const s in e)t.includes(s)||("object"==typeof e[s]?a[s]=w._cloneData(e[s]):a[s]=e[s]);return a}static _cloneData(e){if("object"==typeof e){if(Array.isArray(e)){const t=[];for(let a=0;a<e.length;++a)t[a]=w._cloneData(e[a]);return t}if(null===e)return null;if(e instanceof RegExp)return new RegExp(e);const t={};for(const a in e)t[a]=w._cloneData(e[a]);return t}return e}static timeToString(e,t=!0){const a=e<0?"-":"",s=("00"+(e=Math.abs(e))%1e3).substr(-3),i=("0"+(e%6e4-s)/1e3).substr(-2);return a+("0"+((e%36e5-s)/1e3-i)/60).substr(-2)+":"+i+(t?"."+s:"")}static timeToDateString(e){const t=new Date(e);return t.getFullYear()+"-"+w.zeroPad(t.getMonth()+1)+"-"+w.zeroPad(t.getDate())}static timeToTimeString(e,t=!1){const a=new Date(e);let s=w.zeroPad(a.getHours())+":"+w.zeroPad(a.getMinutes())+":"+w.zeroPad(a.getSeconds());return t&&(s=s+"."+w.zeroPad(a.getMilliseconds(),3)),s}static msToDuration(e){return w.timeToString(e,!1).replace(":","m")+"s"}static dateTimeToString(e,t=!1){const a=new Date(e);let s=a.getFullYear()+"-"+w.zeroPad(a.getMonth()+1)+"-"+w.zeroPad(a.getDate());return s=s+" "+w.zeroPad(a.getHours())+":"+w.zeroPad(a.getMinutes())+":"+w.zeroPad(a.getSeconds()),t&&(s=s+"."+a.getMilliseconds()),s}static zeroPad(e,t=2){return(""+e).padStart(t,"0")}static properCase(e){return e.replace(/([^\W_]+[^\s-]*) */g,(e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()))}static spacePadLeft(e,t){return e.padStart(t," ")}}w.sealRegexes={},w.engageRegexes={},w.countdownRegexes={},w.unsealRegexes={};for(const e in P.areaSeal)w.sealRegexes[e]=P.areaSeal[e],w.engageRegexes[e]=P.countdownEngage[e],w.countdownRegexes[e]=P.countdownStart[e],w.unsealRegexes[e]=P.areaUnseal[e];w.wipeRegex=N.network6d({command:"40000010"}),w.winRegex=N.network6d({command:"40000003"}),w.cactbotWipeRegex=N.echo({line:"cactbot wipe.*?"});class E{constructor(e,t){this.id=e,this.name="",this.server="",this.setName(t),this.states={},this.significantStates=[],this.latestTimestamp=null,this.job=null,this.level=null}setName(e){if(""===e)return;const t=e.split("(");this.name=t[0],t.length>1&&(this.server=t[1].replace(/\)$/,""))}hasState(e){return void 0!==this.states[e]}pushState(e,t){this.states[e]=t,this.latestTimestamp=e,this.significantStates.includes(e)||this.significantStates.push(e)}nextSignificantState(e){const t=this.significantStates.indexOf(e),a=this.significantStates.length-1;if(t>=0&&t<a)return this.states[this.significantStates[t+1]];if(t===a||e>this.significantStates[a])return this.states[this.significantStates[a]];for(let t=0;t<this.significantStates.length;++t)if(this.significantStates[t]>e)return this.states[this.significantStates[t]];return this.states[this.significantStates[this.significantStates.length-1]]}pushPartialState(e,t){void 0!==this.states[e]?Object.keys(this.states[e]).filter((e=>void 0!==t[e])).forEach((a=>{this.states[e][a]="Visible"===a?t[a]:Number(t[a])})):(this.states[e]=this.states[this.latestTimestamp].partialClone(t),this.latestTimestamp=Math.max(this.latestTimestamp,e));const a=this.significantStates[this.significantStates.length-1],s=JSON.stringify(this.states[a]),i=JSON.stringify(this.states[e]);a!==e&&i!==s&&this.significantStates.push(e)}getState(e){if(void 0!==this.states[e])return this.states[e];if(e<this.significantStates[0])return this.states[this.significantStates[0]];let t=0;for(;t<this.significantStates.length;++t)if(this.significantStates[t]>e)return this.states[this.significantStates[t-1]];return this.states[this.significantStates[t-1]]}}class L{static getJob(e){if(!L.abilityMatchRegex.test(e))return null;e=Number("0x"+e);for(const t in L.abilities)if(L.abilities[t].includes(e))return t;return null}}L.abilities={PLD:[12959,12961,12964,12967,12968,12969,12970,12971,12972,12973,12974,12975,12976,12978,12980,12981,12982,12983,12984,12985,12986,12987,12988,12989,12991,12992,12993,12994,12996,13e3,13001,13006,14480,16457,16458,16459,16460,16461,17669,17671,17672,17691,17692,17693,17694,17866,18050,27,29,30,3538,3539,3540,3541,3542,4284,4285,4286,50207,50209,50246,50260,50261,50262,50263,50264,7382,7383,7384,7385,8746,8749,8750,8751,8752,8754,8755,8756],WAR:[16462,16463,16464,16465,17695,17696,17697,17698,17889,3549,3550,3551,3552,4289,4290,4291,49,50157,50218,50249,50265,50266,50267,50268,50269,51,52,7386,7387,7388,7389,8758,8761,8762,8763,8764,8765,8767,8768],DRK:[16466,16467,16468,16469,16470,16471,16472,17700,17701,17702,3617,3621,3623,3624,3625,3629,3632,3634,3636,3638,3639,3640,3641,3643,4303,4304,4305,4306,4307,4308,4309,4310,4311,4312,4680,50158,50159,50271,50272,50319,7390,7391,7392,7393,8769,8772,8773,8775,8776,8777,8778,8779],GNB:[17703,17704,17705,17706,17707,17708,17709,17710,17711,17712,17713,17714,17716,17717,17890,17891,16137,50320,16138,16139,16140,16141,16142,16143,16144,16145,16162,50257,16148,16149,16151,16152,50258,16153,16154,16146,16147,16150,16159,16160,16161,16155,16156,16157,16158,16163,16164,16165,50259],WHM:[12958,12962,12965,12997,13002,13003,13004,13005,131,136,137,139,140,14481,1584,16531,16532,16533,16534,16535,16536,17688,17689,17690,17789,17790,17791,17793,17794,17832,3568,3569,3570,3571,4296,4297,50181,50182,50196,50307,50308,50309,50310,7430,7431,7432,7433,8895,8896,8900,9621,127,133],SCH:[16537,16538,16539,16540,16541,16542,16543,16544,16545,16546,16547,16548,16550,16551,166,167,17215,17216,17795,17796,17797,17798,17802,17864,17865,17869,17870,17990,185,186,188,189,190,3583,3584,3585,3586,3587,4300,50184,50214,50311,50312,50313,50324,7434,7435,7436,7437,7438,7869,802,803,805,8904,8905,8909,9622],AST:[10027,10028,10029,16552,16553,16554,16555,16556,16557,16558,16559,17055,17151,17152,17804,17805,17806,17807,17809,17991,3590,3593,3594,3595,3596,3598,3599,3600,3601,3603,3604,3605,3606,3608,3610,3612,3613,3614,3615,4301,4302,4401,4402,4403,4404,4405,4406,4677,4678,4679,50122,50124,50125,50186,50187,50188,50189,50314,50315,50316,7439,7440,7441,7442,7443,7444,7445,7448,8324,8913,8914,8916,9629],MNK:[12960,12963,12966,12977,12979,12990,12995,12998,12999,14476,14478,16473,16474,16475,16476,17674,17675,17676,17677,17719,17720,17721,17722,17723,17724,17725,17726,3543,3545,3546,3547,4262,4287,4288,50160,50161,50245,50273,50274,63,70,71,7394,7395,7396,74,8780,8781,8782,8783,8784,8785,8787,8789,8925],DRG:[16477,16478,16479,16480,17728,17729,3553,3554,3555,3556,3557,4292,4293,50162,50163,50247,50275,50276,7397,7398,7399,7400,86,8791,8792,8793,8794,8795,8796,8797,8798,8799,8802,8803,8804,8805,8806,92,94,95,96,9640,75,78],NIN:[16488,16489,16491,16492,16493,17413,17414,17415,17416,17417,17418,17419,17420,17732,17733,17734,17735,17736,17737,17738,17739,2246,2259,2260,2261,2262,2263,2264,2265,2266,2267,2268,2269,2270,2271,2272,3563,3566,4295,50165,50166,50167,50250,50279,50280,7401,7402,7403,8807,8808,8809,8810,8812,8814,8815,8816,8820,9461],SAM:[16481,16482,16483,16484,16485,16486,16487,17740,17741,17742,17743,17744,50208,50215,50277,50278,7477,7478,7479,7480,7481,7482,7483,7484,7485,7486,7487,7488,7489,7490,7491,7492,7493,7494,7495,7496,7497,7498,7499,7501,7502,7855,7857,7867,8821,8822,8823,8824,8825,8826,8828,8829,8830,8831,8833],BRD:[10023,114,116,117,118,13007,14479,16494,16495,16496,17678,17679,17680,17681,17682,17745,17747,3558,3559,3560,3561,3562,4294,50168,50169,50282,50283,50284,50285,50286,50287,7404,7405,7406,7407,7408,7409,8836,8837,8838,8839,8841,8842,8843,8844,9625,106],MCH:[16497,16498,16499,16500,16501,16502,16503,16504,16766,16889,17206,17209,17749,17750,17751,17752,17753,17754,2864,2866,2868,2870,2872,2873,2874,2876,2878,2890,4276,4675,4676,50117,50119,50288,50289,50290,50291,50292,50293,50294,7410,7411,7412,7413,7414,7415,7416,7418,8848,8849,8850,8851,8853,8855],DNC:[17756,17757,17758,17759,17760,17761,17762,17763,17764,17765,17766,17767,17768,17769,17770,17771,17772,17773,17824,17825,17826,17827,17828,17829,18076,15989,15990,15993,15997,15999,16e3,16001,16002,16003,16191,16192,15991,15994,16007,50252,15995,15992,15996,16008,16010,50251,16015,16012,16006,18073,50253,16011,16009,50254,15998,16004,16193,16194,16195,16196,16013,16005,50255,50256,16014],BLM:[14477,153,154,158,159,162,16505,16506,16507,17683,17684,17685,17686,17687,17774,17775,3573,3574,3575,3576,3577,4298,50171,50172,50173,50174,50295,50296,50297,50321,50322,7419,7420,7421,7422,8858,8859,8860,8861,8862,8863,8864,8865,8866,8867,8869,9637,149,155,141,152],SMN:[16510,16511,16513,16514,16515,16516,16517,16518,16519,16522,16523,16549,16795,16796,16797,16798,16799,16800,16801,16802,16803,17777,17778,17779,17780,17781,17782,17783,17784,17785,180,184,3578,3579,3580,3581,3582,4299,50176,50177,50178,50213,50217,50298,50299,50300,50301,50302,7423,7424,7425,7426,7427,7428,7429,7449,7450,787,788,791,792,794,796,797,798,800,801,8872,8873,8874,8877,8878,8879,8880,8881,9014,9432],RDM:[10025,16524,16525,16526,16527,16528,16529,16530,17786,17787,17788,50195,50200,50201,50216,50303,50304,50305,50306,7503,7504,7505,7506,7507,7509,7510,7511,7512,7513,7514,7515,7516,7517,7518,7519,7520,7521,7523,7524,7525,7526,7527,7528,7529,7530,8882,8883,8884,8885,8887,8888,8889,8890,8891,8892,9433,9434],BLU:[11715,11383,11384,11385,11386,11387,11388,11389,11390,11391,11392,11393,11394,11395,11396,11397,11398,11399,11400,11401,11402,11403,11404,11405,11406,11407,11408,11409,11410,11411,11412,11413,11414,11415,11416,11417,11418,11419,11420,11421,11422,11423,11424,11425,11426,11427,11428,11429,11430,11431,50219,50220,50221,50222,50223,50224]},L.abilityMatchRegex=/[a-fA-F0-9]{1,4}/i;class F{constructor(e,t,a,s,i,r,n,o,l){this.posX=e,this.posY=t,this.posZ=a,this.heading=s,this.targetable=i,this.HP=r,this.maxHP=n,this.MP=o,this.maxMP=l}partialClone(e){return new F(Number(e.posX)||this.posX,Number(e.posY)||this.posY,Number(e.posZ)||this.posZ,Number(e.heading)||this.heading,e.targetable||this.targetable,Number(e.HP)||this.HP,Number(e.maxHP)||this.maxHP,Number(e.MP)||this.MP,Number(e.maxMP)||this.maxMP)}toPluginState(){return{PosX:this.posX,PosY:this.posY,PosZ:this.posZ,Heading:this.heading,CurrentHP:this.HP,MaxHP:this.maxHP,CurrentMP:this.MP,MaxMP:this.maxMP}}}const T={cn:["绿宝石兽","黄宝石兽","伊弗利特之灵","泰坦之灵","迦楼罗之灵","朝日小仙女","夕月小仙女","车式浮空炮塔","象式浮空炮塔","亚灵神巴哈姆特","亚灵神不死鸟","炽天使","月长宝石兽","英雄的掠影","后式自走人偶","分身"],de:["Smaragd-Karfunkel","Topas-Karfunkel","Ifrit-Egi","Titan-Egi","Garuda-Egi","Eos","Selene","Selbstschuss-Gyrocopter TURM","Selbstschuss-Gyrocopter LÄUFER","Demi-Bahamut","Demi-Phönix","Seraph","Mondstein-Karfunkel","Schattenschemen","Automaton DAME","Gedoppeltes Ich"],en:["Emerald Carbuncle","Topaz Carbuncle","Ifrit-Egi","Titan-Egi","Garuda-Egi","Eos","Selene","Rook Autoturret","Bishop Autoturret","Demi-Bahamut","Demi-Phoenix","Seraph","Moonstone Carbuncle","Esteem","Automaton Queen","Bunshin"],fr:["Carbuncle émeraude","Carbuncle topaze","Ifrit-Egi","Titan-Egi","Garuda-Egi","Eos","Selene","Auto-tourelle Tour","Auto-tourelle Fou","Demi-Bahamut","Demi-Phénix","Séraphin","Carbuncle hécatolite","Estime","Automate Reine","Ombre"],ja:["カーバンクル・エメラルド","カーバンクル・トパーズ","イフリート・エギ","タイタン・エギ","ガルーダ・エギ","フェアリー・エオス","フェアリー・セレネ","オートタレット・ルーク","オートタレット・ビショップ","デミ・バハムート","デミ・フェニックス","セラフィム","カーバンクル・ムーンストーン","英雄の影身","オートマトン・クイーン","分身"],ko:["카벙클 에메랄드","카벙클 토파즈","이프리트 에기","타이탄 에기","가루다 에기","요정 에오스","요정 셀레네","자동포탑 룩","자동포탑 비숍","데미바하무트","데미피닉스","세라핌","카벙클 문스톤","영웅의 환영","자동인형 퀸","분신"]};class k{constructor(e,t){this.language=t,this.firstTimestamp=Number.MAX_SAFE_INTEGER,this.lastTimestamp=0,this.combatants={},this.partyMembers=[],this.enemies=[],this.others=[],this.pets=[],this.mainCombatantID=null,this.initialStates={},this.initialize(e),delete this.initialStates}initialize(e){for(let t=0;t<e.length;++t){const a=e[t];switch(this.firstTimestamp=Math.min(this.firstTimestamp,a.timestamp),this.lastTimestamp=Math.max(this.lastTimestamp,a.timestamp),a.hexEvent){case"14":case"15":case"16":case"19":case"1A":case"1B":case"1E":case"22":case"23":this.addCombatantFromLine(a),this.addCombatantFromTargetLine(a);break;case"00":break;default:this.addCombatantFromLine(a)}}for(const e in this.initialStates){const t=this.initialStates[e];this.combatants[e].pushState(this.firstTimestamp,new F(Number(t.posX),Number(t.posY),Number(t.posZ),Number(t.heading),t.targetable,Number(t.HP),Number(t.maxHP),Number(t.MP),Number(t.maxMP)))}const t={};for(let a=0;a<e.length;++a){const s=e[a];let i=this.extractStateFromLine(s);i&&(t[s.id]=t[s.id]||0,++t[s.id],this.combatants[s.id].pushPartialState(s.timestamp,i)),i=this.extractStateFromTargetLine(s),i&&(t[s.targetId]=t[s.targetId]||0,++t[s.targetId],this.combatants[s.targetId].pushPartialState(s.timestamp,i))}const a=T[this.language];this.others=this.others.filter((e=>null!==this.combatants[e].job&&"NONE"!==this.combatants[e].job&&e.startsWith("1")?(this.partyMembers.push(e),!1):a.includes(this.combatants[e].name)?(this.pets.push(e),!1):!(t[e]>0&&(this.enemies.push(e),1)))),this.mainCombatantID=this.enemies.sort(((e,a)=>t[a]-t[e]))[0]||null}addCombatantFromLine(e){if(!e.id)return;this.initCombatant(e.id,e.name,e.timestamp);const t=this.initialStates[e.id],a=this.extractStateFromLine(e);t.timestamp=Math.min(t.timestamp,e.timestamp),t.posX=t.posX||a.posX||null,t.posY=t.posY||a.posY||null,t.posZ=t.posZ||a.posZ||null,t.heading=t.heading||a.heading||null,t.targetable=t.targetable||a.targetable||!1,t.HP=t.HP||a.HP||null,t.maxHP=t.maxHP||a.maxHP||null,t.MP=t.MP||a.MP||null,t.maxMP=t.maxMP||a.maxMP||null,this.combatants[e.id].job=this.combatants[e.id].job||a.job||null,this.combatants[e.id].level=this.combatants[e.id].level||a.level||null,!e.abilityId||this.combatants[e.id].job||e.id.startsWith("4")||(this.combatants[e.id].job=L.getJob(e.abilityId)),this.combatants[e.id].job&&(this.combatants[e.id].job=this.combatants[e.id].job.toUpperCase())}addCombatantFromTargetLine(e){if(!e.targetId)return;this.initCombatant(e.targetId,e.targetName,e.timestamp);const t=this.initialStates[e.targetId],a=this.extractStateFromTargetLine(e);t.posX=t.posX||a.posX||null,t.posY=t.posY||a.posY||null,t.posZ=t.posZ||a.posZ||null,t.heading=t.heading||a.heading||null,t.HP=t.HP||a.HP||null,t.maxHP=t.maxHP||a.maxHP||null,t.MP=t.MP||a.MP||null,t.maxMP=t.maxMP||a.maxMP||null}extractStateFromLine(e){if(!e.id)return!1;const t={};return void 0!==e.x&&(t.posX=e.x),void 0!==e.y&&(t.posY=e.y),void 0!==e.z&&(t.posZ=e.z),void 0!==e.heading&&(t.heading=e.heading),void 0!==e.targetable&&(t.targetable=e.targetable),void 0!==e.hp&&(t.HP=e.hp),void 0!==e.maxHp&&(t.maxHP=e.maxHp),void 0!==e.mp&&(t.MP=e.mp),void 0!==e.maxMp&&(t.maxMP=e.maxMp),void 0!==e.jobName&&(t.job=e.jobName),void 0!==e.level&&(t.level=e.level),t}extractStateFromTargetLine(e){if(!e.targetId)return!1;const t={};return void 0!==e.targetX&&(t.posX=e.targetX),void 0!==e.targetY&&(t.posY=e.targetY),void 0!==e.targetZ&&(t.posZ=e.targetZ),void 0!==e.targetHeading&&(t.heading=e.targetHeading),void 0!==e.targetHp&&(t.HP=e.targetHp),void 0!==e.targetMaxHp&&(t.maxHP=e.targetMaxHp),void 0!==e.targetMp&&(t.MP=e.targetMp),void 0!==e.targetMaxMp&&(t.maxMP=e.targetMaxMp),t}initCombatant(e,t,a){void 0===this.combatants[e]?(this.combatants[e]=new E(e,t),this.others.push(e),this.initialStates[e]={timestamp:a,posX:null,posY:null,posZ:null,heading:null,targetable:!0,HP:null,maxHP:null,MP:null,maxMP:null}):""===this.combatants[e].name&&(this.combatants[e].name=t)}getMainCombatantName(){return this.mainCombatantID?this.combatants[this.mainCombatantID].name:"Unknown"}}class H{constructor(){this.listeners={}}on(e,t,a){const s=e.split(" "),i={};a=void 0!==a?a:"undefined"==typeof window?{}:window;for(const e of s)this.listeners[e]=this.listeners[e]||[],void 0!==t?this.listeners[e].push({scope:a,callback:t}):i[e]=this.listeners[e];return 1===s.length&&i[e]?i[e]:void 0!==t?i:void 0}async dispatch(e,...t){if(void 0!==this.listeners[e])for(let a=0;a<this.listeners[e].length;++a){const s=this.listeners[e][a],i=s.callback.apply(s.scope,t);Promise.resolve(i)===i&&await i}}}class j extends H{static doesLineMatch(e,t){for(const a in t){const s=t[a].exec(e);if(s)return P.areaSeal[a]&&(s.groups.language=a),s}return!1}static isMatchStart(e){let t;return t=j.doesLineMatch(e,w.countdownRegexes),t?(t.groups.StartIn=1e3*t.groups.time,t.groups.StartType="Countdown",t):(t=j.doesLineMatch(e,w.sealRegexes),t?(t.groups.StartIn=0,t.groups.StartType="Seal",t):(t=j.doesLineMatch(e,w.engageRegexes),!!t&&(t.groups.StartIn=0,t.groups.StartType="Engage",t)))}static isMatchEnd(e){let t;return t=j.doesLineMatch(e,[w.winRegex]),t?(t.groups.EndType="Win",t):(t=j.doesLineMatch(e,[w.wipeRegex]),t?(t.groups.EndType="Wipe",t):(t=j.doesLineMatch(e,[w.cactbotWipeRegex]),t?(t.groups.EndType="Cactbot Wipe",t):(t=j.doesLineMatch(e,w.unsealRegexes),!!t&&(t.groups.EndType="Unseal",t))))}constructor(){super(),this.currentZoneName=null,this.currentFight=[],this.currentZoneId=-1}parseLogs(e){for(let t=0;t<e.length;++t){const a=e[t];this.currentFight.push(a),a.offset=a.timestamp-this.currentFight[0].timestamp,j.isMatchEnd(a.networkLine)?this.endFight():a.zoneName&&(this.currentZoneId=a.zoneId,this.currentZoneName=a.zoneName,this.endFight())}}endFight(){if(this.currentFight.length<2)return;const e=new Date(this.currentFight[0].timestamp);this.currentZoneName=this.currentZoneName||"Unknown",this.currentZoneId=this.currentZoneId||-1,console.debug(`Dispatching new fight\nStart: ${e}\nEnd: ${new Date(this.currentFight[this.currentFight.length-1].timestamp)}\nZone: ${this.currentZoneName}\nLine Count: ${this.currentFight.length}\n`),this.dispatch("fight",e.toISOString().substr(0,10),this.currentZoneId,this.currentZoneName,this.currentFight),this.currentFight=[]}}class A{constructor(e,t,a,s){this.id=null,this.encounterZoneId=t,this.encounterZoneName=a,this.encounterDay=e,this.logLines=s,this.initialize()}initialize(){this.language="en",this.initialOffset=Number.MAX_SAFE_INTEGER,this.endStatus="Unknown",this.startStatus=new Set,this.engageAt=Number.MAX_SAFE_INTEGER,this.firstPlayerAbility=Number.MAX_SAFE_INTEGER,this.firstEnemyAbility=Number.MAX_SAFE_INTEGER;const e=T[this.language];this.firstLineIndex=0;for(let t=0;t<this.logLines.length;++t){const a=this.logLines[t];let s=j.isMatchStart(a.networkLine);s?(this.firstLineIndex=t,this.startStatus.add(s.groups.StartType),s.groups.StartIn>=0&&(this.engageAt=Math.min(a.timestamp+s.groups.StartIn,this.engageAt))):(s=j.isMatchEnd(a.networkLine),s?this.endStatus=s.groups.EndType:a.id&&a.targetId&&(a.id.startsWith("1")||a.id.startsWith("4")&&e.includes(a.name)?a.targetId.startsWith("4")&&!e.includes(a.targetName)&&(this.firstPlayerAbility=Math.min(this.firstPlayerAbility,a.timestamp)):a.id.startsWith("4")&&!e.includes(a.name)&&(a.targetId.startsWith("1")||e.includes(a.targetName))&&(this.firstEnemyAbility=Math.min(this.firstEnemyAbility,a.timestamp)))),s&&s.groups&&s.groups.language&&(this.language=s.groups.language||this.language)}this.firstPlayerAbility===Number.MAX_SAFE_INTEGER&&(this.firstPlayerAbility=null),this.firstEnemyAbility===Number.MAX_SAFE_INTEGER&&(this.firstEnemyAbility=null),this.engageAt===Number.MAX_SAFE_INTEGER&&(this.engageAt=null),this.combatantTracker=new k(this.logLines,this.language),this.startTimestamp=this.combatantTracker.firstTimestamp,this.endTimestamp=this.combatantTracker.lastTimestamp,this.duration=this.endTimestamp-this.startTimestamp,this.initialOffset===Number.MAX_SAFE_INTEGER&&(null!==this.engageAt?this.initialOffset=this.engageAt-this.startTimestamp:null!==this.firstPlayerAbility?this.initialOffset=this.firstPlayerAbility-this.startTimestamp:null!==this.firstEnemyAbility?this.initialOffset=this.firstEnemyAbility-this.startTimestamp:this.initialOffset=0),this.playbackOffset=this.logLines[this.firstLineIndex].offset,this.startStatus=[...this.startStatus].sort().join(", ")}shouldPersistFight(){return this.firstPlayerAbility>0&&this.firstEnemyAbility>0}}class R{constructor(){this.Combatants={},this.firstTimestamp=Number.MAX_SAFE_INTEGER}updateTimestamp(e){this.firstTimestamp=Math.min(this.firstTimestamp,e)}updateCombatant(e,t={name:void 0,job:void 0,spawn:void 0,despawn:void 0}){if((e=e.toUpperCase())&&e.length){let a=this.Combatants[e];void 0===a?(a={name:t.name,job:t.job,spawn:t.spawn,despawn:t.despawn},this.Combatants[e]=a):(a.name=t.name||a.name,a.job=t.job||a.job,a.spawn=Math.min(a.spawn,t.spawn),a.despawn=Math.max(a.despawn,t.despawn))}}resolveName(e,t,a=null,s=null){let i=t;return null!==a&&"E0000000"===e&&""===i&&(i=a.startsWith("4")?s:"Unknown"),""===i&&(i=this.Combatants[e].name),i}}class U{constructor(e,t,a){this.offset=0,this.parts=a,this.decEvent=parseInt(this.parts[0]),this.hexEvent=w.zeroPad(this.decEvent.toString(16).toUpperCase()),this.timestamp=+new Date(this.parts[1]),this.networkLine=t,e.updateTimestamp(this.timestamp)}convert(){this.convertedLine=this.prefix()+this.parts.join(":").replace("|",":")}prefix(){return"["+w.timeToTimeString(this.timestamp,!0)+"] "+this.hexEvent+":"}static isDamageHallowed(e){return parseInt(e,16)&parseInt("1000",16)}static isDamageBig(e){return parseInt(e,16)&parseInt("4000",16)}static calculateDamage(e){if(U.isDamageHallowed(e))return 0;const t=[(e=w.zeroPad(e,8)).substr(0,2),e.substr(2,2),e.substr(4,2),e.substr(6,2)];return U.isDamageBig(e)?parseInt(t[3]+t[0]+(parseInt(t[1],16)-parseInt(t[3],16)).toString(16),16):parseInt(t.slice(0,2).reverse().join(""),16)}}class D extends U{constructor(e,t,a){super(e,t,a),this.parts.slice(4).join("|").split("").length>1&&(this.invalid=!0)}convert(){this.convertedLine=this.prefix()+this.parts[2]+":"+(""!==this.parts[3]?this.parts[3]+":":"")+this.parts.slice(4,this.parts.length-1).join("|").trim(),this.convertedLine=z.replaceChatSymbols(this.convertedLine)}static replaceChatSymbols(e){for(const t of z.chatSymbolReplacements)e=e.replace(t.Search,t.Replace);return e}}class z extends D{}z.chatSymbolReplacements=[{Search:/:\uE06F/g,Replace:":⇒",Type:"Symbol"},{Search:/ \uE0BB\uE05C/g,Replace:" ",Type:"Positive Effect"},{Search:/ \uE0BB\uE05B/g,Replace:" ",Type:"Negative Effect"}];class O extends U{constructor(e,t,a){super(e,t,a),this.zoneId=a[2].toUpperCase(),this.zoneName=a[3],this.zoneNameProperCase=w.properCase(this.zoneName)}convert(){this.convertedLine=this.prefix()+"Changed Zone to "+this.zoneName+".",this.properCaseConvertedLine=this.prefix()+"Changed Zone to "+this.zoneNameProperCase+"."}}class Z extends O{}class B extends U{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3]}convert(){this.convertedLine=this.prefix()+"Changed primary player to "+this.name+"."}}class G extends B{}const X={NONE:0,GLA:1,PGL:2,MRD:3,LNC:4,ARC:5,CNJ:6,THM:7,CRP:8,BSM:9,ARM:10,GSM:11,LTW:12,WVR:13,ALC:14,CUL:15,MIN:16,BTN:17,FSH:18,PLD:19,MNK:20,WAR:21,DRG:22,BRD:23,WHM:24,BLM:25,ACN:26,SMN:27,SCH:28,ROG:29,NIN:30,MCH:31,DRK:32,AST:33,SAM:34,RDM:35,BLU:36,GNB:37,DNC:38},Y=Object.keys(X),_=["GLA","PLD","MRD","WAR","DRK","GNB"],W=["CNJ","WHM","SCH","AST"],$=["PGL","MNK","LNC","DRG","ROG","NIN","SAM"],J=["ARC","BRD","DNC","MCH"],K=["BLU","RDM","BLM","SMN","ACN","THM"],V=[...$,...J,...K],q=["CRP","BSM","ARM","GSM","LTW","WVR","ALC","CUL"],Q=["MIN","BTN","FSH"],ee=((()=>{const e=(e,t,a)=>{t.forEach((t=>e.set(t,a)))},t=new Map([["NONE","none"]]);e(t,_,"tank"),e(t,W,"healer"),e(t,V,"dps"),e(t,q,"crafter"),e(t,Q,"gatherer")})(),e=>{const t=Y.find((t=>X[t]===e));return null!=t?t:"NONE"});class te extends U{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],this.server=a[8],this.jobIdHex=a[4].toUpperCase(),this.jobIdDec=parseInt(this.jobIdHex,16),this.jobName=ee(this.jobIdDec),this.level=parseInt(a[5],16),this.hp=parseInt(a[11]),this.maxHp=parseInt(a[12]),this.mp=parseInt(a[13]),this.maxMp=parseInt(a[14]),this.x=parseFloat(a[17]),this.y=parseFloat(a[18]),this.z=parseFloat(a[19]),this.heading=parseFloat(a[20]),e.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp,job:this.jobIdHex})}convert(){let e=this.name;""!==this.server&&(e=e+"("+this.server+")"),this.convertedLine=this.prefix()+this.id.toUpperCase()+":Added new combatant "+e+".  Job: "+this.jobName+" Level: "+this.level+" Max HP: "+this.maxHp+" Max MP: "+this.maxMp+" Pos: ("+this.parts[17]+","+this.parts[18]+","+this.parts[19]+")";const t=this.parts[9]+w.zeroPad(this.parts[10],8+Math.max(0,6-this.parts[9].length));"00000000000000"!==t&&(this.convertedLine+=" ("+t+")"),this.convertedLine+="."}}class ae extends te{}class se extends te{constructor(e,t,a){super(e,t,a)}convert(){this.convertedLine=this.prefix()+this.id.toUpperCase()+":Removing combatant "+this.name+".  Max HP: "+this.maxHp+". Pos: ("+this.parts[17]+","+this.parts[18]+","+this.parts[19]+")."}}class ie extends se{}class re extends U{constructor(e,t,a){super(e,t,a)}convert(){this.convertedLine=this.prefix()+"Player Stats: "+this.parts.slice(2,this.parts.length-1).join(":").replace(/\|/g,":")}}class ne extends re{}class oe extends U{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],e.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp}),this.abilityId=a[4].toUpperCase(),this.abilityName=a[5],this.targetId=a[6].toUpperCase(),this.targetName=a[7],e.updateCombatant(this.targetId,{name:this.targetName,spawn:this.timestamp,despawn:this.timestamp}),this.castTime=a[8]}convert(){const e=0===this.targetName.length?"Unknown":this.targetName;this.convertedLine=this.prefix()+this.abilityId+":"+this.name+" starts using "+this.abilityName+" on "+e+".",this.properCaseConvertedLine=this.prefix()+this.abilityId+":"+w.properCase(this.name)+" starts using "+this.abilityName+" on "+w.properCase(e)+"."}}class le extends oe{}class pe extends U{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],e.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp}),this.abilityId=a[4].toUpperCase(),this.abilityName=a[5],this.targetId=a[6].toUpperCase(),this.targetName=a[7],e.updateCombatant(this.targetId,{name:this.targetName,spawn:this.timestamp,despawn:this.timestamp}),this.flags=a[8];let s=0;"3F"===this.flags&&(s=2),this.damage=U.calculateDamage(a[9+s]),this.targetHp=a[24+s],this.targetMaxHp=a[25+s],this.targetMp=a[26+s],this.targetMaxMp=a[27+s],this.targetX=a[30+s],this.targetY=a[31+s],this.targetZ=a[32+s],this.targetHeading=a[33+s],this.sourceHp=a[34+s],this.sourceMaxHp=a[35+s],this.sourceMp=a[36+s],this.sourceMaxMp=a[37+s],this.x=this.sourceX=a[40+s],this.y=this.sourceY=a[41+s],this.z=this.sourceZ=a[42+s],this.heading=this.sourceHeading=a[43+s]}}class me extends pe{}class de extends pe{constructor(e,t,a){super(e,t,a)}}class ce extends de{}class he extends U{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],this.abilityId=a[4].toUpperCase(),this.abilityName=a[5]}}class ue extends he{}class ge extends U{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],e.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp}),this.type=a[4],this.effectId=a[5].toUpperCase(),this.damage=parseInt(a[6],16),this.hp=parseInt(a[7]),this.maxHp=parseInt(a[8]),this.mp=parseInt(a[9]),this.maxMp=parseInt(a[10]),this.x=parseFloat(a[13]),this.y=parseFloat(a[14]),this.z=parseFloat(a[15]),this.heading=parseFloat(a[16]),this.resolvedName=e.resolveName(this.id,this.name)}convert(e){this.effectName=ge.showEffectNamesFor[this.effectId.toUpperCase()];let t="";this.effectName&&(t=this.effectName+" "),this.convertedLine=this.prefix()+t+this.type+" Tick on "+this.resolvedName+" for "+this.damage+" damage.",this.properCaseConvertedLine=this.prefix()+t+this.type+" Tick on "+w.properCase(this.resolvedName)+" for "+this.damage+" damage."}}class fe extends ge{}ge.showEffectNamesFor={"4C4":"Excognition","35D":"Wildfire","1F5":"Doton","2ED":"Salted Earth","4B5":"Flamethrower","2E3":"Asylum",777:"Asylum",798:"Sacred Soil","4C7":"Fey Union",742:"Nascent Glint"};class ye extends U{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],e.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp}),this.targetId=a[4].toUpperCase(),this.targetName=a[5],e.updateCombatant(this.targetId,{name:this.targetName,spawn:this.timestamp,despawn:this.timestamp}),this.resolvedName=!1,"00"!==this.id&&(this.resolvedName=e.resolveName(this.id,this.name)),this.resolvedTargetName=!1,"00"!==this.targetId&&(this.resolvedTargetName=e.resolveName(this.targetId,this.targetName))}convert(){this.convertedLine=this.prefix()+this.resolvedName||this.name+" was defeated by "+this.resolvedTargetName||this.targetName+".",this.properCaseConvertedLine=this.prefix()+w.properCase(this.resolvedName||this.name)+" was defeated by "+w.properCase(this.resolvedTargetName||this.targetName)+"."}}class be extends ye{}class Ce extends U{constructor(e,t,a){super(e,t,a),this.abilityId=a[2].toUpperCase(),this.abilityName=a[3],this.duration=parseFloat(a[4]),this.stacks=parseInt(a[9],16),this.id=a[5].toUpperCase(),this.name=a[6],e.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp}),this.targetId=a[7].toUpperCase(),this.targetName=a[8],e.updateCombatant(this.targetId,{name:this.targetName,spawn:this.timestamp,despawn:this.timestamp}),this.resolvedName=e.resolveName(this.id,this.name),this.resolvedTargetName=e.resolveName(this.targetId,this.targetName),this.fallbackResolvedTargetName=e.resolveName(this.id,this.name,this.targetId,this.targetName)}convert(){let e="";this.stacks>0&&this.stacks<20&&Ce.showStackCountFor.includes(this.abilityId)&&(e=" ("+this.stacks+")"),this.convertedLine=this.prefix()+this.targetId+":"+this.targetName+" gains the effect of "+this.abilityName+" from "+this.fallbackResolvedTargetName+" for "+this.parts[4]+" Seconds."+e,this.properCaseConvertedLine=this.prefix()+this.targetId+":"+w.properCase(this.targetName)+" gains the effect of "+this.abilityName+" from "+w.properCase(this.fallbackResolvedTargetName)+" for "+this.parts[4]+" Seconds."+e}}class ve extends Ce{}Ce.showStackCountFor=["130","196","15e","2ca","1f9","4d7","511"];class xe extends U{constructor(e,t,a){super(e,t,a),this.targetId=a[2].toUpperCase(),this.targetName=a[3]}}class Ie extends xe{}class Ne extends U{constructor(e,t,a){super(e,t,a),this.id=a[4].toUpperCase(),this.name=a[5]}}class Me extends Ne{}class Se extends U{constructor(e,t,a){super(e,t,a)}}class Pe extends Se{}class we extends Ce{constructor(e,t,a){super(e,t,a)}convert(){let e="";this.stacks>0&&this.stacks<20&&Ce.showStackCountFor.includes(this.abilityId)&&(e=" ("+this.stacks+")"),this.convertedLine=this.prefix()+this.targetId+":"+this.targetName+" loses the effect of "+this.abilityName+" from "+this.fallbackResolvedTargetName+"."+e,this.properCaseConvertedLine=this.prefix()+this.targetId+":"+w.properCase(this.targetName)+" loses the effect of "+this.abilityName+" from "+w.properCase(this.fallbackResolvedTargetName)+"."+e}}class Ee extends we{}class Le extends U{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase();const s=w.zeroPad(a[3],8),i=w.zeroPad(a[4],8),r=w.zeroPad(a[5],8),n=w.zeroPad(a[6],8),o=e=>[e.substr(6,2),e.substr(4,2),e.substr(2,2),e.substr(0,2)];this.jobGaugeBytes=[...o(s),...o(i),...o(r),...o(n)],e.updateCombatant(this.id,{spawn:this.timestamp,despawn:this.timestamp,job:this.jobGaugeBytes[0].toUpperCase()})}convert(e){this.name=e.Combatants[this.id].name,this.convertedLine=this.prefix()+this.id+":"+this.name+":"+this.parts[3]+":"+this.parts[4]+":"+this.parts[5]+":"+this.parts[6],this.properCaseConvertedLine=this.prefix()+this.id+":"+w.properCase(this.name)+":"+this.parts[3]+":"+this.parts[4]+":"+this.parts[5]+":"+this.parts[6]}}class Fe extends Le{}class Te extends U{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],this.targetId=a[4].toUpperCase(),this.targetName=a[5],this.targetable=!!parseInt(a[6],16)}}class ke extends Te{}class He extends U{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],this.targetId=a[4].toUpperCase(),this.targetName=a[5]}}class je extends He{}class Ae extends U{constructor(e,t,a){super(e,t,a),this.value=parseInt(a[2],16),this.bars=a[3]}convert(){this.convertedLine=this.prefix()+"Limit Break: "+this.parts[2]}}class Re extends Ae{}class Ue extends U{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],this.hp=a[5],this.maxHp=a[6],this.mp=a[7],this.maxMp=a[8],this.x=a[11],this.y=a[12],this.z=a[13],this.heading=a[14]}}class De extends Ue{}class ze extends U{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3];const s=w.zeroPad(a[4],8);this.jobIdHex=s.substr(6,2).toUpperCase(),this.jobIdDec=parseInt(this.jobIdHex,16),this.jobName=ee(this.jobIdDec),this.level=parseInt(s.substr(4,2),16),this.hp=a[5],this.maxHp=a[6],this.mp=a[7],this.maxMp=a[8],this.x=a[11],this.y=a[12],this.z=a[13],this.heading=a[14]}}class Oe extends ze{}class Ze extends U{constructor(e,t,a){super(e,t,a),this.id=a[2].toUpperCase(),this.name=a[3],this.hp=a[4],this.maxHp=a[5],this.mp=a[6],this.maxMp=a[7],this.x=a[10],this.y=a[11],this.z=a[12],this.heading=a[13]}}class Be extends Ze{}class Ge extends H{async convertFile(e){const t=new R;return await this.convertLines(e.split(Ge.lineSplitRegex).filter((e=>""!==e)),t)}async convertLines(e,t){this.Combatants={},t=t||new R,e=e.map((e=>class{static parse(e,t){let a;const s=t.split("|"),i=s[0];if("252"===i)return!1;switch("LineEvent"+i){case"LineEvent00":a=new z(e,t,s);break;case"LineEvent01":a=new Z(e,t,s);break;case"LineEvent02":a=new G(e,t,s);break;case"LineEvent03":a=new ae(e,t,s);break;case"LineEvent04":a=new ie(e,t,s);break;case"LineEvent12":a=new ne(e,t,s);break;case"LineEvent20":a=new le(e,t,s);break;case"LineEvent21":a=new me(e,t,s);break;case"LineEvent22":a=new ce(e,t,s);break;case"LineEvent23":a=new ue(e,t,s);break;case"LineEvent24":a=new fe(e,t,s);break;case"LineEvent25":a=new be(e,t,s);break;case"LineEvent26":a=new ve(e,t,s);break;case"LineEvent27":a=new Ie(e,t,s);break;case"LineEvent28":a=new Me(e,t,s);break;case"LineEvent29":a=new Pe(e,t,s);break;case"LineEvent30":a=new Ee(e,t,s);break;case"LineEvent31":a=new Fe(e,t,s);break;case"LineEvent34":a=new ke(e,t,s);break;case"LineEvent35":a=new je(e,t,s);break;case"LineEvent36":a=new Re(e,t,s);break;case"LineEvent37":a=new De(e,t,s);break;case"LineEvent38":a=new Oe(e,t,s);break;case"LineEvent39":a=new Be(e,t,s);break;default:a=new U(e,t,s)}return!(a&&a.timestamp<946684800)&&(!a||!a.invalid)&&a}}.parse(t,e))).filter((e=>e));for(let a=0;a<e.length;++a)e[a].convert(t),e[a].index=a;return e.sort(((e,t)=>(e.timestamp+"_"+e.index).localeCompare(t.timestamp+"_"+t.index)))}}Ge.lineSplitRegex=/\r?\n/gm,onmessage=async e=>{const t=new Ge,a=new j,s=new R;a.on("fight",(async(e,t,a,s)=>{const i=new A(e,t,a,s);i.shouldPersistFight()&&postMessage({type:"encounter",encounter:i,name:i.combatantTracker.getMainCombatantName()})}));const i=new TextDecoder("UTF-8");let r=new Uint8Array(e.data),n=0,o=[],l=0;for(let e=n;n<r.length&&-1!==n;e=n){n=r.indexOf(10,n+1);const p=i.decode(r.slice(e,n)).trim();p.length&&(++l,o.push(p)),o.length>=1e3&&(o=await t.convertLines(o,s),a.parseLogs(o),postMessage({type:"progress",lines:l,bytes:n,totalBytes:r.length}),o=[])}o.length>0&&(o=await t.convertLines(o,s),a.parseLogs(o),o=[]),postMessage({type:"progress",lines:l,bytes:r.length,totalBytes:r.length}),r=null,a.endFight(),postMessage({type:"done"})}})();